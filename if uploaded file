from st_aggrid import AgGrid, GridOptionsBuilder

# metrics_df should already be created from your Excel upload and look like:
# columns: ['query', 'avg_revenue', 'total_revenue', 'avg_rpc', 'total_rpc', 'avg_clicks', 'total_clicks']

# --- Interactive Keyword Picker Table (AgGrid) ---
st.subheader("Pick a keyword to add to Force Keys (search/filter above the table!)")

gb = GridOptionsBuilder.from_dataframe(metrics_df)
gb.configure_selection('single', use_checkbox=True)  # single row selection with checkbox
grid_options = gb.build()

grid_response = AgGrid(
    metrics_df,
    gridOptions=grid_options,
    update_mode='SELECTION_CHANGED',
    height=400,
    width='100%',
    fit_columns_on_grid_load=True
)

selected = grid_response['selected_rows']
if selected:
    keyword = selected[0]['query']
    if st.button(f"Add '{keyword}' to next Force Key"):
        fill_next_force_key(keyword)
        st.experimental_rerun()
